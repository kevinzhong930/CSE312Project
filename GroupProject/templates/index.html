<html>
<head>
    <title>Chirper</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}" />
</head>

<body onload="welcome();">

    <h1>Chirper</h1>

    <br />
    <hr />

    <div class="contents">
        <!-- User Registration and Login Section -->
        <div class="container">
            <h1>Chirper</h1>
            <div id="username">
    
            </div>
            <div class="btn-group">
                <button onclick="toggleForm('register')">Register</button>
                <button onclick="toggleForm('login')">Login</button>
            </div>
    
            <form id="registrationForm" class="auth-form" action="/register" method="POST" style="display: none;">
                <h2>Register</h2>
                <input type="text" name="username" placeholder="Username" required>
                <input type="password" name="password" placeholder="Password" required>
                <button type="submit">Register</button>
            </form>
    
            <form id="loginForm" class="auth-form" action="/login" method="POST" style="display: none;">
                <h2>Login</h2>
                <input type="text" name="username" placeholder="Username" required>
                <input type="password" name="password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
        </div>
    </div>

    <!-- Post Section -->
    <div class="Posts">
        <h2>All Posts</h2>
        <div id="postHistory">
            <!-- Individual posts will appear here, added dynamically with JavaScript -->
        </div>

        <hr>
        <h2>Create a New Post</h2>
        <div class="post-form">
            <label>
                Title:
                <input id="post-title-box" type="text">
            </label>
            <br>
            <label>
                Description:
                <textarea id="post-description-box"></textarea>
            </label>
            <br>
            <button id="post-button" onclick="sendPost()">Post</button>
            <input value="{{ xsrfToken }}" id="xsrf-token" hidden>
        </div>
    </div>

    <script>
        function getUsername() {
            fetch('/get-username')  
                .then(response => response.json())
                .then(data => {
                    if (data.username) {
                        document.getElementById('username').innerHTML = `Logged in as: ${data.username}`;
                    } else {
                        document.getElementById('username').innerHTML = 'Not logged in';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }    
        getUsername();
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="{{ url_for('static', filename='functions.js') }}"></script>

    <div id="errorModal" class="modal">
        <div class="modal-content">
            <span class="closeBtn" onclick="closeModal()">&times;</span>
            <p id="errorMsg"></p>
        </div>
    </div>

</body>
</html>
